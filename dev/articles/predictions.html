<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="marginaleffects">
<title>Predictions • marginaleffects</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predictions">
<meta property="og:description" content="marginaleffects">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">marginaleffects</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.9.0.9051</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/marginaleffects.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/vincentarelbundock/marginaleffects/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="predictions_files/kePrint-0.0.1/kePrint.js"></script><link href="predictions_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Predictions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vincentarelbundock/marginaleffects/blob/HEAD/vignettes/predictions.Rmd" class="external-link"><code>vignettes/predictions.Rmd</code></a></small>
      <div class="d-none name"><code>predictions.Rmd</code></div>
    </div>

    
    
<p>In the context of this package, an “Adjusted Prediction” is defined
as:</p>
<blockquote>
<p>The outcome predicted by a fitted model on a specified scale for a
given combination of values of the predictor variables, such as their
observed values, their means, or factor levels (a.k.a. “reference
grid”).</p>
</blockquote>
<p>Here, the word “Adjusted” simply means “model-derived” or
“model-based.”</p>
<div class="section level2">
<h2 id="prediction-type-or-scale">Prediction type (or scale)<a class="anchor" aria-label="anchor" href="#prediction-type-or-scale"></a>
</h2>
<p>Using the <code>type</code> argument of the
<code><a href="../reference/predictions.html">predictions()</a></code> function we can specify the “scale” on which
to make predictions. This refers to either the scale used to estimate
the model (i.e., link scale) or to a more interpretable scale (e.g.,
response scale). For example, when fitting a linear regression model
using the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> function, the link scale and the response
scale are identical. An “Adjusted Prediction” computed on either scale
will be expressed as the mean value of the response variable at the
given values of the predictor variables.</p>
<p>On the other hand, when fitting a binary logistic regression model
using the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function (which uses a binomial family and
a logit link ), the link scale and the response scale will be different:
an “Adjusted Prediction” computed on the link scale will be expressed as
a log odds of a “successful” response at the given values of the
predictor variables, whereas an “Adjusted Prediction” computed on the
response scale will be expressed as a probability that the response
variable equals 1.</p>
<p>The default value of the <code>type</code> argument for most models
is “response”, which means that the <code><a href="../reference/predictions.html">predictions()</a></code> function
will compute predicted probabilities (binomial family), Poisson means
(poisson family), etc.</p>
</div>
<div class="section level2">
<h2 id="prediction-grid">Prediction grid<a class="anchor" aria-label="anchor" href="#prediction-grid"></a>
</h2>
<p>To compute adjusted predictions we must first specify the values of
the predictors to consider: a “reference grid.” For example, if our
model is a linear model fitted with the lm() function which relates the
response variable Happiness with the predictor variables Age, Gender and
Income, the reference grid could be a <code>data.frame</code> with
values for Age, Gender and Income: Age = 40, Gender = Male, Income =
60000.</p>
<p>The “reference grid” may or may not correspond to actual observations
in the dataset used to fit the model; the example values given above
could match the mean values of each variable, or they could represent a
specific observed (or hypothetical) individual. The reference grid can
include many different rows if we want to make predictions for different
combinations of predictors. By default, the <code><a href="../reference/predictions.html">predictions()</a></code>
function uses the full original dataset as a reference grid, which means
it will compute adjusted predictions for each of the individuals
observed in the dataset that was used to fit the model.</p>
</div>
<div class="section level2">
<h2 id="the-predictions-function">The <code>predictions()</code> function<a class="anchor" aria-label="anchor" href="#the-predictions-function"></a>
</h2>
<p>By default, <code>predictions</code> calculates the
regression-adjusted predicted values for every observation in the
original dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|) 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      20.0      1.204 16.6   &lt;0.001  17.7   22.4</span></span>
<span><span class="co">#&gt;      20.0      1.204 16.6   &lt;0.001  17.7   22.4</span></span>
<span><span class="co">#&gt;      26.4      0.962 27.5   &lt;0.001  24.5   28.3</span></span>
<span><span class="co">#&gt;      20.0      1.204 16.6   &lt;0.001  17.7   22.4</span></span>
<span><span class="co">#&gt;      15.9      0.992 16.0   &lt;0.001  14.0   17.9</span></span>
<span><span class="co">#&gt;      20.2      1.219 16.5   &lt;0.001  17.8   22.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, std.error, statistic, p.value, conf.low, conf.high, mpg, hp, cyl</span></span></code></pre></div>
<p>In many cases, this is too limiting, and researchers will want to
specify a grid of “typical” values over which to compute adjusted
predictions.</p>
</div>
<div class="section level2">
<h2 id="adjusted-predictions-at-user-specified-values-aka-adjusted-predictions-at-representative-values-apr">Adjusted Predictions at User-Specified values (aka Adjusted
Predictions at Representative values, APR)<a class="anchor" aria-label="anchor" href="#adjusted-predictions-at-user-specified-values-aka-adjusted-predictions-at-representative-values-apr"></a>
</h2>
<p>There are two main ways to select the reference grid over which we
want to compute adjusted predictions. The first is using the
<code>variables</code> argument. The second is with the
<code>newdata</code> argument and the <a href="https://vincentarelbundock.github.io/marginaleffects/reference/datagrid.html"><code>datagrid()</code>
function</a> that we already introduced in the <a href="https://vincentarelbundock.github.io/marginaleffects/articles/slopes.html">marginal
effects vignette.</a></p>
<div class="section level3">
<h3 id="variables-counterfactual-predictions">
<code>variables</code>: Counterfactual predictions<a class="anchor" aria-label="anchor" href="#variables-counterfactual-predictions"></a>
</h3>
<p>The <code>variables</code> argument is a handy way to create and make
predictions on counterfactual datasets. For example, here the dataset
that we used to fit the model has 32 rows. The counterfactual dataset
with two distinct values of <code>hp</code> has 64 rows: each of the
original rows appears twice, that is, once with each of the values that
we specified in the <code>variables</code> argument:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">120</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|) 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      20.3      1.238 16.38   &lt;0.001  17.9   22.7</span></span>
<span><span class="co">#&gt;      20.3      1.238 16.38   &lt;0.001  17.9   22.7</span></span>
<span><span class="co">#&gt;      26.2      0.986 26.63   &lt;0.001  24.3   28.2</span></span>
<span><span class="co">#&gt;      20.3      1.238 16.38   &lt;0.001  17.9   22.7</span></span>
<span><span class="co">#&gt;      17.7      1.881  9.42   &lt;0.001  14.0   21.4</span></span>
<span><span class="co">#&gt;      20.3      1.238 16.38   &lt;0.001  17.9   22.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, rowidcf, type, estimate, std.error, statistic, p.value, conf.low, conf.high, mpg, cyl, hp</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 64</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="newdata-and-datagrid">
<code>newdata</code> and <code>datagrid</code><a class="anchor" aria-label="anchor" href="#newdata-and-datagrid"></a>
</h3>
<p>A second strategy to construct grids of predictors for adjusted
predictions is to combine the <code>newdata</code> argument and the
<code>datagrid</code> function. Recall that this function creates a
“typical” dataset with all variables at their means or modes, except
those we explicitly define:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>, model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;        mpg       hp cyl</span></span>
<span><span class="co">#&gt; 1 20.09062 146.6875   4</span></span>
<span><span class="co">#&gt; 2 20.09062 146.6875   6</span></span>
<span><span class="co">#&gt; 3 20.09062 146.6875   8</span></span></code></pre></div>
<p>We can also use this <code>datagrid</code> function in a
<code>predictions</code> call (omitting the <code>model</code>
argument):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error  z Pr(&gt;|z|) 2.5 % 97.5 %  hp cyl</span></span>
<span><span class="co">#&gt;      16.6       1.28 13   &lt;0.001  14.1   19.1 147   8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, std.error, statistic, p.value, conf.low, conf.high, mpg, hp, cyl</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|) 2.5 % 97.5 %  hp cyl</span></span>
<span><span class="co">#&gt;      25.1       1.37 18.4   &lt;0.001  22.4   27.8 147   4</span></span>
<span><span class="co">#&gt;      19.2       1.25 15.4   &lt;0.001  16.7   21.6 147   6</span></span>
<span><span class="co">#&gt;      16.6       1.28 13.0   &lt;0.001  14.1   19.1 147   8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, std.error, statistic, p.value, conf.low, conf.high, mpg, hp, cyl</span></span></code></pre></div>
<p>Users can change the summary function used to summarize each type of
variables using the <code>FUN_numeric</code>, <code>FUN_factor</code>,
and related arguments. For example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">drat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">am</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>FUN_factor <span class="op">=</span> <span class="va">unique</span>, FUN_numeric <span class="op">=</span> <span class="va">median</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|) 2.5 % 97.5 %  hp drat cyl am</span></span>
<span><span class="co">#&gt;      22.0       1.29 17.0   &lt;0.001  19.4   24.5 123  3.7   6  1</span></span>
<span><span class="co">#&gt;      18.2       1.27 14.3   &lt;0.001  15.7   20.7 123  3.7   6  0</span></span>
<span><span class="co">#&gt;      25.5       1.32 19.3   &lt;0.001  23.0   28.1 123  3.7   4  1</span></span>
<span><span class="co">#&gt;      21.8       1.54 14.1   &lt;0.001  18.8   24.8 123  3.7   4  0</span></span>
<span><span class="co">#&gt;      22.6       2.14 10.6   &lt;0.001  18.4   26.8 123  3.7   8  1</span></span>
<span><span class="co">#&gt;      18.9       1.73 10.9   &lt;0.001  15.5   22.3 123  3.7   8  0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, std.error, statistic, p.value, conf.low, conf.high, mpg, hp, drat, cyl, am</span></span></code></pre></div>
<p>The <code>data.frame</code> produced by <code>predictions</code> is
“tidy”, which makes it easy to manipulate with other <code>R</code>
packages and functions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span>, hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">110</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hp</span>, <span class="va">cyl</span>, <span class="va">estimate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>values_from <span class="op">=</span> <span class="va">estimate</span>, names_from <span class="op">=</span> <span class="va">cyl</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"A table of Adjusted Predictions"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span>header <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"cyl"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<caption>
A table of Adjusted Predictions
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
cyl
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
hp
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
8
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
20.27858
</td>
<td style="text-align:right;">
26.24623
</td>
<td style="text-align:right;">
17.72538
</td>
</tr>
<tr>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
20.03819
</td>
<td style="text-align:right;">
26.00585
</td>
<td style="text-align:right;">
17.48500
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="counterfactual-data-grid">
<code>counterfactual</code> data grid<a class="anchor" aria-label="anchor" href="#counterfactual-data-grid"></a>
</h3>
<p>An alternative approach to construct grids of predictors is to use
<code>grid_type = "counterfactual"</code> argument value. This will
duplicate the <em>whole</em> dataset, with the different values
specified by the user.</p>
<p>For example, the <code>mtcars</code> dataset has 32 rows. This
command produces a new dataset with 64 rows, with each row of the
original dataset duplicated with the two values of the <code>am</code>
variable supplied (0 and 1):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">am</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, grid_type <span class="op">=</span> <span class="st">"counterfactual"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">nd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 64  4</span></span></code></pre></div>
<p>Then, we can use this dataset and the <code>predictions</code>
function to create interesting visualizations:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, grid_type <span class="op">=</span> <span class="st">"counterfactual"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">am</span>, <span class="va">estimate</span>, <span class="va">rowidcf</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">rowidcf</span>, </span>
<span>                names_from <span class="op">=</span> <span class="va">am</span>,</span>
<span>                values_from <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`0`</span>, y <span class="op">=</span> <span class="va">`1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted Pr(vs=1), when am = 0"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Predicted Pr(vs=1), when am = 1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p>In this graph, each dot represents the predicted probability that
<code>vs=1</code> for one observation of the dataset, in the
counterfactual worlds where <code>am</code> is either 0 or 1.</p>
</div>
</div>
<div class="section level2">
<h2 id="adjusted-prediction-at-the-mean-apm">Adjusted Prediction at the Mean (APM)<a class="anchor" aria-label="anchor" href="#adjusted-prediction-at-the-mean-apm"></a>
</h2>
<p>Some analysts may want to calculate an “Adjusted Prediction at the
Mean,” that is, the predicted outcome when all the regressors are held
at their mean (or mode). To achieve this, we use the
<code>datagrid</code> function. By default, this function produces a
grid of data with regressors at their means or modes, so all we need to
do to get the APM is:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Pr(&gt;|z|)   2.5 % 97.5 %  hp    am</span></span>
<span><span class="co">#&gt;    0.0631   0.0656 0.00379  0.543 147 0.406</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, p.value, conf.low, conf.high, vs, hp, am</span></span></code></pre></div>
<p>This is equivalent to calling:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Pr(&gt;|z|)   2.5 % 97.5 %  hp    am</span></span>
<span><span class="co">#&gt;    0.0631   0.0656 0.00379  0.543 147 0.406</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, p.value, conf.low, conf.high, vs, hp, am</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="average-adjusted-predictions-aap">Average Adjusted Predictions (AAP)<a class="anchor" aria-label="anchor" href="#average-adjusted-predictions-aap"></a>
</h2>
<p>An “Average Adjusted Prediction” is the outcome of a two step
process:</p>
<ol style="list-style-type: decimal">
<li>Create a new dataset with each of the original regressor values, but
fixing some regressors to values of interest.</li>
<li>Take the average of the predicted values in this new dataset.</li>
</ol>
<p>We can obtain AAPs by applying the <code>avg_*()</code> functions or
<code>by</code> argument:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modlin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">modlin</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|) 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      20.1      0.556 36.1   &lt;0.001    19   21.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code></pre></div>
<p>This is equivalent to:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">modlin</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20.09062</span></span></code></pre></div>
<p>Note that in GLM models with a non-linear link function, the
predictions are first made on the link scale, averaged, and then back
transformed. Thus, the average prediction may not be exactly identical
to the average of predictions:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">am</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">estimate</span></span>
<span><span class="co">#&gt; [1] 0.06308965</span></span>
<span></span>
<span><span class="co"># Step 1: predict on the link scale</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span><span class="op">$</span><span class="va">estimate</span></span>
<span><span class="co"># Step 2: average</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co"># Step 3: backtransform</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.06308965</span></span></code></pre></div>
<p>Users who want the average of individual-level predictions on the
response scale can specify the <code>type</code> argument
explicitly:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|) 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0.437     0.0429 10.2   &lt;0.001 0.353  0.522</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="average-adjusted-predictions-by-group">Average Adjusted Predictions by Group<a class="anchor" aria-label="anchor" href="#average-adjusted-predictions-by-group"></a>
</h2>
<p>We can compute average adjusted predictions for different subsets of
the data with the <code>by</code> argument.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, by <span class="op">=</span> <span class="st">"am"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  am Estimate Pr(&gt;|z|)   2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;   0   0.0591   0.1163 0.00198  0.665</span></span>
<span><span class="co">#&gt;   1   0.0694   0.0755 0.00424  0.566</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: type, am, estimate, p.value, conf.low, conf.high</span></span></code></pre></div>
<p>In the next example, we create a “counterfactual” data grid where
each observation of the dataset is repeated twice, with different values
of the <code>am</code> variable, and all other variables held at the
observed values. We also show the equivalent results using
<code>dplyr</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"am"</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagridcf</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  am Estimate Pr(&gt;|z|)    2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;   0  0.24043   0.3922 2.22e-02  0.815</span></span>
<span><span class="co">#&gt;   1  0.00696   0.0359 6.81e-05  0.419</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: type, am, estimate, p.value, conf.low, conf.high</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagridcf</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">am</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>AAP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;      am   AAP</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 0.526</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 0.330</span></span></code></pre></div>
<div class="section level3">
<h3 id="multinomial-models">Multinomial models<a class="anchor" aria-label="anchor" href="#multinomial-models"></a>
</h3>
<p>One place where this is particularly useful is in multinomial models
with different response levels. For example, here we compute the average
predicted outcome for each outcome level in a multinomial logit model.
Note that response levels are identified by the “group” column.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">nnet</a></span><span class="op">)</span></span>
<span><span class="va">nom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">+</span> <span class="va">am</span> <span class="op">*</span> <span class="va">vs</span>, data <span class="op">=</span> <span class="va">mtcars</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># first 5 raw predictions</span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, type <span class="op">=</span> <span class="st">"probs"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Group Estimate Std. Error        z Pr(&gt;|z|)     2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;      3 3.62e-05   2.00e-03   0.0181   0.9856 -3.89e-03 3.96e-03</span></span>
<span><span class="co">#&gt;      3 3.62e-05   2.00e-03   0.0181   0.9856 -3.89e-03 3.96e-03</span></span>
<span><span class="co">#&gt;      3 9.35e-08   6.91e-06   0.0135   0.9892 -1.35e-05 1.36e-05</span></span>
<span><span class="co">#&gt;      3 4.04e-01   1.97e-01   2.0569   0.0397  1.91e-02 7.90e-01</span></span>
<span><span class="co">#&gt;      3 1.00e+00   1.25e-03 802.4451   &lt;0.001  9.98e-01 1.00e+00</span></span>
<span><span class="co">#&gt;      3 5.18e-01   2.90e-01   1.7884   0.0737 -4.97e-02 1.09e+00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  probs </span></span>
<span><span class="co">#&gt; Columns: rowid, type, group, estimate, std.error, statistic, p.value, conf.low, conf.high, gear, mpg, am, vs</span></span>
<span></span>
<span><span class="co"># average predictions</span></span>
<span><span class="fu"><a href="../reference/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">nom</span>, type <span class="op">=</span> <span class="st">"probs"</span>, by <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Group Estimate Std. Error     z Pr(&gt;|z|)  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      3    0.469     0.0404 11.60   &lt;0.001 0.3895  0.548</span></span>
<span><span class="co">#&gt;      4    0.375     0.0614  6.11   &lt;0.001 0.2546  0.495</span></span>
<span><span class="co">#&gt;      5    0.156     0.0462  3.38   &lt;0.001 0.0656  0.247</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  probs </span></span>
<span><span class="co">#&gt; Columns: type, group, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code></pre></div>
<p>We can use custom aggregations by supplying a data frame to the
<code>by</code> argument. All columns of this data frame must be present
in the output of <code><a href="../reference/predictions.html">predictions()</a></code>, and the data frame must
also include a <code>by</code> column of labels. In this example, we
“collapse” response groups:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">by</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"3,4"</span>, <span class="st">"3,4"</span>, <span class="st">"5"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, type <span class="op">=</span> <span class="st">"probs"</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)  2.5 % 97.5 %  By</span></span>
<span><span class="co">#&gt;     0.422     0.0231 18.25   &lt;0.001 0.3766  0.467 3,4</span></span>
<span><span class="co">#&gt;     0.156     0.0462  3.38   &lt;0.001 0.0656  0.247 5  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  probs </span></span>
<span><span class="co">#&gt; Columns: type, estimate, std.error, statistic, p.value, conf.low, conf.high, by</span></span></code></pre></div>
<p>This can be very useful in combination with the
<code>hypothesis</code> argument. For example, here we compute the
difference between average adjusted predictions for the 3 and 4 response
levels, compared to the 5 response level:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, type <span class="op">=</span> <span class="st">"probs"</span>, by <span class="op">=</span> <span class="va">by</span>, hypothesis <span class="op">=</span> <span class="st">"sequential"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Estimate Std. Error     z Pr(&gt;|z|)  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  5 - 3,4   -0.266     0.0694 -3.83   &lt;0.001 -0.402  -0.13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  probs </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code></pre></div>
<p>We can also use more complicated aggregations. Here, we compute the
predicted probability of outcome levels for each value of
<code>cyl</code>, by collapsing the “3” and “4” outcome levels:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">by</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    group <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>    cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># define labels</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>        <span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"3/4 Gears &amp; %s Cylinders"</span>, <span class="va">cyl</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"5 Gears &amp; %s Cylinders"</span>, <span class="va">cyl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)   2.5 % 97.5 %                      By</span></span>
<span><span class="co">#&gt;     0.409     0.0580 7.06   &lt;0.001  0.2956  0.523 3/4 Gears &amp; 4 Cylinders</span></span>
<span><span class="co">#&gt;     0.429     0.0661 6.49   &lt;0.001  0.2991  0.558 3/4 Gears &amp; 6 Cylinders</span></span>
<span><span class="co">#&gt;     0.429     0.0458 9.35   &lt;0.001  0.3387  0.518 3/4 Gears &amp; 8 Cylinders</span></span>
<span><span class="co">#&gt;     0.182     0.1159 1.57    0.117 -0.0457  0.409 5 Gears &amp; 4 Cylinders  </span></span>
<span><span class="co">#&gt;     0.143     0.1321 1.08    0.280 -0.1161  0.402 5 Gears &amp; 6 Cylinders  </span></span>
<span><span class="co">#&gt;     0.143     0.0917 1.56    0.119 -0.0368  0.323 5 Gears &amp; 8 Cylinders  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  probs </span></span>
<span><span class="co">#&gt; Columns: type, estimate, std.error, statistic, p.value, conf.low, conf.high, by</span></span></code></pre></div>
<p>And we can then compare the different groups using the
<code>hypothesis</code> argument:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, by <span class="op">=</span> <span class="va">by</span>, hypothesis <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                               Term  Estimate Std. Error         z Pr(&gt;|z|)    2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 4 Cylinders - 3/4 Gears &amp; 6 Cylinders -1.93e-02     0.0879 -0.219838   0.8260 -0.19158  0.153</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 4 Cylinders - 3/4 Gears &amp; 8 Cylinders -1.93e-02     0.0739 -0.261054   0.7941 -0.16414  0.126</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 4 Cylinders - 5 Gears &amp; 4 Cylinders    2.28e-01     0.1739  1.309479   0.1904 -0.11312  0.569</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 4 Cylinders - 5 Gears &amp; 6 Cylinders    2.66e-01     0.1443  1.846188   0.0649 -0.01642  0.549</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 4 Cylinders - 5 Gears &amp; 8 Cylinders    2.66e-01     0.1085  2.455117   0.0141  0.05371  0.479</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 6 Cylinders - 3/4 Gears &amp; 8 Cylinders  2.84e-05     0.0804  0.000353   0.9997 -0.15757  0.158</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 6 Cylinders - 5 Gears &amp; 4 Cylinders    2.47e-01     0.1334  1.851410   0.0641 -0.01449  0.509</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 6 Cylinders - 5 Gears &amp; 6 Cylinders    2.86e-01     0.1982  1.441537   0.1494 -0.10275  0.674</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 6 Cylinders - 5 Gears &amp; 8 Cylinders    2.86e-01     0.1130  2.527631   0.0115  0.06415  0.507</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 8 Cylinders - 5 Gears &amp; 4 Cylinders    2.47e-01     0.1247  1.981364   0.0476  0.00267  0.491</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 8 Cylinders - 5 Gears &amp; 6 Cylinders    2.86e-01     0.1399  2.042634   0.0411  0.01156  0.560</span></span>
<span><span class="co">#&gt;  3/4 Gears &amp; 8 Cylinders - 5 Gears &amp; 8 Cylinders    2.86e-01     0.1375  2.076746   0.0378  0.01606  0.555</span></span>
<span><span class="co">#&gt;  5 Gears &amp; 4 Cylinders - 5 Gears &amp; 6 Cylinders      3.86e-02     0.1758  0.219838   0.8260 -0.30588  0.383</span></span>
<span><span class="co">#&gt;  5 Gears &amp; 4 Cylinders - 5 Gears &amp; 8 Cylinders      3.86e-02     0.1478  0.261054   0.7941 -0.25112  0.328</span></span>
<span><span class="co">#&gt;  5 Gears &amp; 6 Cylinders - 5 Gears &amp; 8 Cylinders     -5.68e-05     0.1608 -0.000353   0.9997 -0.31526  0.315</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  probs </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bayesian-models">Bayesian models<a class="anchor" aria-label="anchor" href="#bayesian-models"></a>
</h3>
<p>The same strategy works for bayesian models:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">*</span> <span class="va">vs</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="va">bernoulli</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, by <span class="op">=</span> <span class="st">"vs"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  vs Estimate 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;   0    0.327 0.182  0.507</span></span>
<span><span class="co">#&gt;   1    0.499 0.366  0.672</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, vs, estimate, conf.low, conf.high</span></span></code></pre></div>
<p>The results above show the median of the posterior distribution of
group-wise means. Note that we take the mean of predicted values for
each MCMC draw before computing quantiles. This is equivalent to:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstantools/reference/posterior_epred.html" class="external-link">posterior_epred</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">draws</span><span class="op">[</span>, <span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.025</span>, <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       50%      2.5%     97.5% </span></span>
<span><span class="co">#&gt; 0.3271836 0.1824479 0.5072074</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">draws</span><span class="op">[</span>, <span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.025</span>, <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       50%      2.5%     97.5% </span></span>
<span><span class="co">#&gt; 0.4993250 0.3657956 0.6721267</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conditional-adjusted-predictions-plot">Conditional Adjusted Predictions (Plot)<a class="anchor" aria-label="anchor" href="#conditional-adjusted-predictions-plot"></a>
</h2>
<p>First, we download the <code>ggplot2movies</code> dataset from the <a href="https://vincentarelbundock.github.io/Rdatasets/articles/data.html" class="external-link">RDatasets
archive</a>. Then, we create a variable called
<code>certified_fresh</code> for movies with a rating of at least 8.
Finally, we discard some outliers and fit a logistic regression
model:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/ggplot2movies/movies.csv"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>style <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">Action</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Action"</span>,</span>
<span>                             <span class="va">Comedy</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Comedy"</span>,</span>
<span>                             <span class="va">Drama</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Drama"</span>,</span>
<span>                             <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Other"</span><span class="op">)</span>,</span>
<span>           style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">style</span><span class="op">)</span>,</span>
<span>           certified_fresh <span class="op">=</span> <span class="va">rating</span> <span class="op">&gt;=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">length</span> <span class="op">&lt;</span> <span class="fl">240</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">certified_fresh</span> <span class="op">~</span> <span class="va">length</span> <span class="op">*</span> <span class="va">style</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code></pre></div>
<p>We can plot adjusted predictions, conditional on the
<code>length</code> variable using the <code>plot_predictions</code>
function:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">certified_fresh</span> <span class="op">~</span> <span class="va">length</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"length"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-28-1.png" width="576"></p>
<p>We can also introduce another condition which will display a
categorical variable like <code>style</code> in different colors. This
can be useful in models with interactions:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">certified_fresh</span> <span class="op">~</span> <span class="va">length</span> <span class="op">*</span> <span class="va">style</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"style"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-29-1.png" width="576"></p>
<p>Since the output of <code><a href="../reference/plot_predictions.html">plot_predictions()</a></code> is a
<code>ggplot2</code> object, it is very easy to customize. For example,
we can add points for the actual observations of our dataset like
so:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mt</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span><span class="va">mt</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">mt</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"hp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mt</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mt</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mt</span>, <span class="va">hp</span> <span class="op">&gt;</span> <span class="fl">250</span><span class="op">)</span>,</span>
<span>                    nudge_y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-30-1.png" width="576"></p>
<p>We can also use <code><a href="../reference/plot_predictions.html">plot_predictions()</a></code> in models with
multinomial outcomes or grouped coefficients. For example, notice that
when we call <code>draw=FALSE</code>, the result includes a
<code>group</code> column:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span> <span class="op">~</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"probs"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"mpg"</span>,</span>
<span>    draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid  type group  estimate  std.error statistic       p.value  conf.low conf.high gear      mpg</span></span>
<span><span class="co">#&gt; 1     1 probs     3 0.9714990 0.03872773  25.08536 7.185838e-139 0.8955941  1.047404    3 10.40000</span></span>
<span><span class="co">#&gt; 2     2 probs     3 0.9656724 0.04393256  21.98079 4.397495e-107 0.8795661  1.051779    3 10.87959</span></span>
<span><span class="co">#&gt; 3     3 probs     3 0.9586759 0.04963084  19.31613  3.930287e-83 0.8614012  1.055951    3 11.35918</span></span>
<span><span class="co">#&gt; 4     4 probs     3 0.9502914 0.05579948  17.03047  4.880938e-65 0.8409265  1.059656    3 11.83878</span></span>
<span><span class="co">#&gt; 5     5 probs     3 0.9402691 0.06238682  15.07160  2.490123e-51 0.8179932  1.062545    3 12.31837</span></span>
<span><span class="co">#&gt; 6     6 probs     3 0.9283274 0.06930549  13.39472  6.492421e-41 0.7924911  1.064164    3 12.79796</span></span></code></pre></div>
<p>Now we use the <code>group</code> column:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"probs"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"mpg"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-32-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="prediction-types">Prediction types<a class="anchor" aria-label="anchor" href="#prediction-types"></a>
</h2>
<p>The <code>predictions</code> function computes model-adjusted means
on the scale of the output of the <code>predict(model)</code> function.
By default, <code>predict</code> produces predictions on the
<code>"response"</code> scale, so the adjusted predictions should be
interpreted on that scale. However, users can pass a string to the
<code>type</code> argument, and <code>predictions</code> will consider
different outcomes.</p>
<p>Typical values include <code>"response"</code> and
<code>"link"</code>, but users should refer to the documentation of the
<code>predict</code> of the package they used to fit the model to know
what values are allowable. documentation.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">mpg</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0.461     0.1158 3.98  &lt; 0.001 0.2340  0.688</span></span>
<span><span class="co">#&gt;     0.461     0.1158 3.98  &lt; 0.001 0.2340  0.688</span></span>
<span><span class="co">#&gt;     0.598     0.1324 4.52  &lt; 0.001 0.3384  0.857</span></span>
<span><span class="co">#&gt;     0.492     0.1196 4.11  &lt; 0.001 0.2573  0.726</span></span>
<span><span class="co">#&gt;     0.297     0.1005 2.95  0.00314 0.0999  0.494</span></span>
<span><span class="co">#&gt;     0.260     0.0978 2.66  0.00787 0.0682  0.452</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, std.error, statistic, p.value, conf.low, conf.high, am, mpg</span></span>
<span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error       z Pr(&gt;|z|)  2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;   -0.1559      0.466 -0.3345   0.7380 -1.070  0.7578</span></span>
<span><span class="co">#&gt;   -0.1559      0.466 -0.3345   0.7380 -1.070  0.7578</span></span>
<span><span class="co">#&gt;    0.3967      0.551  0.7204   0.4713 -0.683  1.4761</span></span>
<span><span class="co">#&gt;   -0.0331      0.479 -0.0692   0.9448 -0.971  0.9049</span></span>
<span><span class="co">#&gt;   -0.8621      0.482 -1.7903   0.0734 -1.806  0.0817</span></span>
<span><span class="co">#&gt;   -1.0463      0.509 -2.0575   0.0396 -2.043 -0.0496</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, std.error, statistic, p.value, conf.low, conf.high, am, mpg</span></span></code></pre></div>
<p>We can also plot predictions on different outcome scales:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"mpg"</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-34-1.png" width="576"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"mpg"</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-35-1.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Vincent Arel-Bundock.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
